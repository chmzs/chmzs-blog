---
title: "使用rBacon构建深度-年代模型"
author:
  - rBacon
  - Chmzs(转制)
keywords:
  - rBacon Vignette
  - Age-Depth Model
  - R Markdown
date: "2022-05-24"
categories: [R, rbacon, age-depth, learn, pollen]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = T,
  tidy = T,
  fig.align = "left",
  fig.width = 8,
  fig.showtext = TRUE
)
```

\[toc\] \# clam 传统线性模型

```{r}
library(clam)
```

基本的默认模型是通过 clam 附带的标准核心的过时级别进行线性插值：

```{r}
clam()
## 
## Example's 95% confidence ranges span from 20 to 535 yr (average 231 yr)
```

或者，例如，平滑样条曲线 (4)：

```{r}
clam(, 4)
```

或者假设在 470 cm 核心深度处发生了沉积间断，从而导致了时间间隔：

```{r}
clam(, 4, hiatus=470)
```

或者，快速沉积事件：在 280-270 厘米深度处有一层厚厚的火山灰：

```{r}
clam(, 4, hiatus=470, slump=c(280, 270))
```

要查看所有 clam 的选项，请键入：

```{r}
?clam
```

如果您希望/需要将文件放在不同的文件夹中，例如 U 盘：

```{r}
clam(, coredir="E:/")
```

# rbacon 入门

Bacon 是一种年龄-深度建模工具，可将沉积岩芯划分为（默认）5 cm 大小等厚的切块（thickness），并假设每个部分内都存在线性沉积物积累。不同部分之间的累积速率可能会发生变化，并且这种可变性受到初始信息（prior information）的限制（见下文）。Bacon可以使用放射性碳日期（在运行时对其进行校准）或已经在日历年内的日期。

Bacon 通过 R（或 Rstudio）工作，并且需要最新版本的 R（至少 4.0.1）。当你第一次在你的电脑上使用 Bacon 时，你必须安装它的 R 包，在 R 的终端输入：

```{r}
# install.packages('rbacon')
```

要使用 rbacon，首先必须加载包（这也会加载它的配套包 IntCal）：

```{r}
library(rbacon)
```

该软件包带有两个预加载的数据集：MSB2K 和 RLGH3。首先运行默认内核 MSB2K。请注意 R 关于文件放置位置的注释，因为我们稍后将需要此信息。按"y"和/或 Enter 接受任何建议。

```{r}
Bacon()
```

如图说明： - 绿色：先验分布 - 灰色：后验分布，通过将先验分布与日期深度结合起来，建立acc.rate模型。 - 在这种情况下，没有学到多少新东西 - 灰色和绿色的重合是指加入率和内存的重合 - 许多数据点，但没有惊喜 Bacon 将校准任何 C-14 日期，运行 MCMC，计算年龄范围，生成图表并提供有关置信范围的信息。下面的输出图表包含许多包含重要信息的面板（因此请不要将它们剪掉以用于您的出版物）：

-   首先，在**左上角**，我们可以看到运行的所有 **MCMC（马尔可夫链蒙特卡罗）**迭代的"拟合"或"能量"。如果迭代似乎与能量较低和较高的部分聚集在一起，那么运行可能并不顺利，您可能想尝试使用更多迭代（参数 ssize）运行您的岩心。

-   顶部的**第二个面板**显示了累积速率（以 **yr/cm** 为单位，因此实际上是沉降时间）。先验（绿色）是具有两个参数的伽马分布：acc.mean 和 acc.shape。伽马分布的值始终 \> 0，确保正累积速率。较大的形状值将导致更多峰值的先验分布（prior distributions）。灰色形状显示后验分布（posterior distribution）。

-   然后我们有memory的先验（绿色）和后验（灰色），或者沉积速率从一个深度到另一个深度的变化程度。。这是一个 beta 分布，它允许值介于 0 和 1 之间。非常低的memory先验将允许累积速率的高度可变性，而一个非常高的memory先验将导致一个几乎是直线的年龄-深度模型。。还显示了分段线性模型的截面厚度，以及由此产生的截面数量。

如果您设置了断点（沉积间断），则**最右侧的顶部面板**将显示此先验（绿色）和后验（灰色）分布。对此的先验是均匀分布（但始终 \> 0；默认情况下最大值设置为 10,000 年，但可以更改）。

最后是主面板，它以蓝色（校准的 C-14 日期）或**绿色（cal BP 日期）**显示日期的分布。*更精确的日期*将比*不太精确的、更宽的日期*峰值更高（在深度尺度上）。年龄-深度模型以灰度显示，灰色越深表示更确定的区域。红色虚线表示平均模型，灰色虚线表示95%的置信区间。

除了图表，Bacon 还生成包含每个深度（默认为从顶部到底部每cm的岩心深度）的年龄估计值（95% 范围和平均值）的文件。该文件可以在岩心文件夹中找到: [文件夹和文件的位置](https://mirrors.sjtug.sjtu.edu.cn/cran/web/packages/rbacon/vignettes/foldersfiles.html)

# 先验和其他设置

rbacon 附带的另一个岩心是 RLGH3（Blaauw， 2018）。该岩心的测年密度低于 MSB2K，并且有一个部分似乎存在异常日期（或者换句话说，某些日期似乎与其他附近的日期不一致）。由于初始检查表明比 rbacon 的**沉积速率默认值 20 yr/cm**更慢的累积速率（或者更确切地说是沉降时间），rbacon 将询问是否应该将之前的值更改为 50 yr/cm。现在，用n或Enter回答，以便使用默认的、不适应的设置。 Goring等人，2012年分析了美国东北部\>200个湖泊/潮汐湿地的经典年龄深度模型的沉积时间平均约 20 yr/cm的Gamma分布，shape介于 \>1 和 2 之间；acon的默认值：acc.mean = 20，shape = 1.5

```{r}
Bacon('RLGH3')
```

请注意，在默认设置下，年龄模型绕过了130和60 cm岩心深度之间的一些较年轻的日期，因为较老的日期似乎与模型更适合，而在岩心下层和上层的日期则更适合。除此之外，模型还绕过了底部的日期，因为如果年龄模型要通过这个日期，就需要大规模地改变沉积时间，这似乎是先验信息的默认设置所禁止的。因此，让我们再次运行模型，这次接受累积率acc.mean的建议值50 yr/cm（（键入y并按Enter）：

```{r}
Bacon('RLGH3')
```

有了经过调整的积累率的先验，现在底部的日期被考虑进去了。现在，如果您信任的人告诉您，他们从附近的其他湖泊中获得了一些非常有力的信息，即沉积时间很可能是 50 年/cm，该怎么办？然后我们可以将先验设置为比默认值更具限制性 - 我们让绿色曲线的峰值更高，以便累积速率被"强制"为 50 yr/cm 左右的值：

```{r}
Bacon('RLGH3', acc.mean=50, acc.shape=100)
```

Bacon按照吩咐去做。后验累积速率与 50 年/cm的先验平均值非常吻合。然而，年龄深度模型本身非常直接且不太现实，并且大多数日期不适合该模型。 还要注意显示 MCMC 运行的左上角面板；前一千次左右的迭代仍然不是最佳的，应该使用该scissors函数真正删除。总而言之，这不是一个好的年龄深度模型，再次与您的专家交谈可能是个好主意，或者找到另一个具有更真实先验信息的人。

在比较累积速率和内存的先验（绿色）和后验（灰色）分布时，考虑贝叶斯方法旨在将先验信息与新数据相结合以"了解"过程可能会有所帮助，在换句话说，更新其有关所涉及参数的信息。**选择的默认先验足够广泛，以允许数据告知我们累积速率及其可变性。** \## 记忆Memory 除了累积速率的先验之外，另一个先验是内存的先验，它定义了积累率从一个岩心深度到另一个岩心深度的变化程度。举个例子，在之前的运行中，内存（最右边的顶部面板）一直是 **1 或 100%**（x轴）。换句话说，一个深度的累积速率与相邻深度的累积速率高度相关。如果您有一个采样点，其中您有关于累积速率必须保持多少恒定的信息（例如，河流沉积物采样点可能有非常偶发和变化的累积），因此可以使用**内存先验**将其包括在内。

## 沉积间断和slumps

如果您的采样点存在沉积间断（累积差距），则可以通过提供它们的深度来设置这些间断。默认情况下，间断的最大长度为 10,000 年，但可以对此进行调整，例如：

```{r}
Bacon("RLGH3", acc.mean=50, hiatus.depths=125, hiatus.max=1000)
```

如果你的岩心有快速沉积（例如，可见的火山灰层），它们也可以被建模：

```{r}
Bacon("RLGH3", acc.mean=50, slump=c(140, 120, 40, 30))
```

## section thickness 截面厚度

Bacon的基础模型是由片状线性剖面组成的，对于每个剖面，积累率的模型是由积累率和记忆的先验因素所制约的。剖面，**默认为 5 cm厚 ( thick=5)**。然而，对于非常短的岩心，这将导致一个非常弯的模型。对于非常长的岩心，默认的剖面厚度可能导致参数太多，模型会失去自我。因此，对于非常短或长的岩心，将建议使用不同的厚度值thick。

有时对于thick判断困难的岩心，最好先用更少、更厚的部分运行它，以便找到有用的先验和设置组合，然后用更多、更薄的部分再次运行它，以获得看起来像'的年龄深度模型足够光滑'。每次，还要检查 MCMC 运行是否正常且稳定，请检查并显示年龄模型图的所有面板。

要查看所有选项和设置，请寻求帮助：

```{r}
?Bacon
```

要查看年龄模型图的所有选项和设置，请键入：

```{r}
?agedepth
```

# 文件夹和文件的位置

重要的是要了解 rbacon 去哪里寻找文件并放置新文件。第一次rbacon是在一个新的工作目录中运行，它会寻找一个名为Bacon_runs（或Cores）的文件夹，如果没有找到，它会询问是否可以创建一个。要么接受建议，要么通过coredir指定提供替代文件夹：

```{r}
mydir <- tempdir()
Bacon(coredir=mydir)
```

在这个伞形文件夹中是每个单独岩心的文件夹。例如，如果您运行了默认内核，则会有一个文件夹MSB2K，类似地为RLGH3. 在每个岩心文件夹中都有包含日期​​的文件，以岩心名称开头并以 .csv 扩展名结尾，例如MSB2K.csv. 因此，如果您的**岩心名为MyLakeCore，那么 Bacon 将查找名为 的文件夹MyLakeCore**，然后在该文件夹中查找**文件MyLakeCore.csv**。注意大小写，**最好不要在名称中使用空格。**

您的文件格式应包含如下标题，并且字段应以**逗号分隔**。在 MS-Excel 或 Libreoffice 的 Calc 等电子表格程序中，您可以将文件保存为\*\* .csv\*\*。然后在纯文本编辑器（如写字板或记事本）中打开 .csv 文件通常是个好主意，以检查所有内容是否干净（例如，没有仅用逗号填充的行，或大量引号）。

它在电子表格程序中的样子： \| lab ID \| Age \| Error \| Depth \| cc \| \| ----------- \| ----------- \| ----- \| -------- \| ---- \| \| UBA-28881 \| 2200 \| 20 \| 5 \| 1 \| \| UBA-28882 \| 2400 \| 20 \| 10 \| 1 \| \| UBA-28883 \| 3550 \| 30 \| 20 \| 1 \| \| UBA-28884 \| 4200 \| 35 \| 25 \| 1 \|

在纯文本编辑器中（添加空格以增强可读性）： lab ID, Age, Error, Depth, cc UBA-28881, 2200, 20, 5, 1 UBA-28882, 2400, 20, 10, 1 UBA-28883, 3550, 30, 20, 1 UBA-28884, 4200, 35, 25, 1

由于计算机管理员设置的权限限制，一些用户报告了对其某些文件夹的写入权限问题。也许您可以访问外部磁盘驱动器，例如D:. 然后将Bacon运行为Bacon("MyCore", coredir="D:"). 然后 Bacon 会MyCore在D:\里.

如果您有带有年龄偏移的日期，例如来自具有已知 delta.R 和 delta.STD 的地区的海洋日期，那么可以将其指定为选项（例如，Bacon(delta.R=130, delta.STD=30)），或者建议在岩心csv 文件中添加新列.。将它们添加为第 6 列和第 7 列（在此示例中，第二行的日期是陆地日期并且没有假定的年龄偏移）： \| lab ID \| Age \| Error \| Depth \| cc \| delta.R \| delta.STD \| \| ----------- \| ----------- \| ----- \| -------- \| ---- \| ------- \| --------- \| \| UBA-28881 \| 2200 \| 20 \| 5 \| 2 \| 130 \| 30 \| \| UBA-34567 \| 1850 \| 20 \| 12 \| 1 \| 0 \| 0 \| \| UBA-28882 \| 2400 \| 20 \| 10 \| 2 \| 130 \| 30 \| \| UBA-28883 \| 3550 \| 30 \| 20 \| 2 \| 130 \| 30 \| \| UBA-28884 \| 4200 \| 35 \| 25 \| 2 \| 130 \| 30 \|

默认情况下，Bacon 使用 student-t 分布1来模拟日期，而不是更常见的正态分布（默认值：Bacon(normal=FALSE)）。使用**默认参数t.a=3和t.b=4**，这个分布看起来很像正态分布，但它的尾部更宽。这使得它成为一个非常稳健的模型，因为它能很好地处理散点和异常值。在许多情况下，Bacon将能够在大多数日期中找到自己的方式，而绕过离群的日期。

在某些情况下，某些日期可能比其他日期更可靠（例如，某些日期由非常可靠的木炭颗粒组成，而其他日期则基于大量沉积物）。然后可以为此类日期提供类似于正态分布的 **student-t 值(例如 , t.a=33t.b=34)**，作为 Bacon 命令中的选项或 .csv 文件中的选项： \| lab ID \| Age \| Error \| Depth \| cc \| delta.R \| delta.STD \| t.a \| t.b \| \| ----------- \| ----------- \| ----- \| -------- \| ---- \| ------- \| --------- \| ---- \| ----- \| \| UBA-28881 \| 2200 \| 20 \| 5 \| 2 \| 130 \| 30 \| 3 \| 4 \| \| UBA-34567 \| 1850 \| 20 \| 12 \| 1 \| 0 \| 0 \| 33 \| 34 \| \| UBA-28882 \| 2400 \| 20 \| 10 \| 2 \| 130 \| 30 \| 3 \| 4 \| \| UBA-28883 \| 3550 \| 30 \| 20 \| 2 \| 130 \| 30 \| 3 \| 4 \| \| UBA-28884 \| 4200 \| 35 \| 25 \| 2 \| 130 \| 30 \| 3 \| 4 \|

如果要在 .csv 文件中提供 ta 和 tb 值，它们应始终位于第 8 列和第 9 列中（同样，cc 应位于第 5 列中，delta.R 应位于第 6 列中，delta.STD 应位于第 7 列中）。如果 delta.R 和 delta.STD 不需要调整，只需为它们提供 0。

## 用户交互

默认情况下，Bacon会告诉它将放置文件的位置并在适当的地方建议值。您还可以告诉 Bacon 停止建议替代值，或者接受所有建议并在没有用户交互的情况下运行岩心：

```{r}
Bacon('RLGH3', suggest=FALSE)
```

如图结果 Bacon建议将acc.mean调整为50，但我们说不行。 - 先验和后验的accrates不同 - 但对记忆来说没有区别 - 最低点的日期被模拟为离群值

```{r}
Bacon('RLGH3', accept.suggestions=TRUE)
```

如上： - 我们接受Bacon的建议，将acc.mean调整为50 - 前验和后验的acc.rates现在更加相似了 - 最地下的日期不是离群的 - 记忆：后验与先验重合，但比先验低一点

-   这表明先验信息如何被透明地用于绕过一些日期，以引导一个模型

    -   最低点的日期是离群的还是累积率发生了变化？

    ```{r}
    allcores <- list.files("Bacon_runs")
    for(i in allcores)
      try(Bacon(i, accept.suggestions=TRUE))
    ```

# 运行后分析

默认情况下，Bacon 将为每个年龄模型运行执行数百万次 MCMC 迭代，尽管只有一小部分会被存储。在大多数情况下，剩余的 MCMC 迭代将很好地混合（迭代拟合的左上图没有显示出奇怪的特征，例如**突然的系统性下降或上升**）。但是，如果迭代似乎没有很好地混合，或者剩余的太少（比如少于几百个），那么您可以检查 Gelman和Rubin的还原系数（**越小越接近 1 越好**）。运行之间的差异过大（系数过高）表明MCMC混合效果不佳。稳健的MCMC混合是指Gelman和Rubin的还原系数**低于1.05**的安全阈值。因此，可考虑加样本量？

例如，尝试使用默认岩心，以非常小的样本量运行五次ssize=100：检查 MCMC 运行是否有任何问题，

```{r}
Baconvergence("MSB2K", thick=5, runs=5, ssize=100, coredir=tempfile())
```

对于可靠、稳定的 MCMC 运行而言，仅使用ssize100 次迭代显然太少了。最后，您需要大约 3,000 次以上的存储迭代和稳定的运行，这看起来像"白噪声"，没有局部最优和长水平延伸等特征。 对于可靠的、稳定的MCMC运行来说，所用的ssize只有100次迭代，显然太小了。最终你会希望有大约3000次以上的存储迭代和稳定的运行，这看起来像 "白噪声"，没有局部优化和长水平延伸等特征。

如果你有一个很长的MCMC输出，并想把它变薄或削减以达到一个更容易管理的大小，请查看函数scissors()和thinner()。 \## 灰度图 一旦生成了强大、可靠和现实的年龄深度模型，乐趣就开始了。例如，灰度图不仅可用于显示一条年龄深度曲线，还可用于显示整个 MCMC 运行输出。如果孢粉或其他 "代用指标 "在岩心的不同深度进行了分析，那么这些代用指标可以在时间尺度上绘制成灰度的 "ghost"，其中不太确定的部分会比比较确定的部分绘制成浅灰色。Bacon在岩心的文件夹中寻找一个文件，以岩心的名字开头，以_proxies.csv结尾，例如，Bacon_runs/MSB2K/MSB2K_proxies.csv。这个文件应该有用逗号分隔的列，第一列是深度，后面是代用指标的列。第一行应该包含各列的名称。要产生MSB2K第七个代用指标的代理ghost。

```{r}
proxy.ghost(7)
```

还可以为整个岩心 ( accrate.depth.ghost) 或随时间 ( accrate.age.ghost) 的累积速率生成ghost图：

```{r}
accrate.depth.ghost()
accrate.age.ghost()
```

## 其他分析

R提供了一个非常适合查询年龄模型输出的环境。得到任意单个岩心深度的年龄估计值：

```{r}
Bacon.hist(20)
```

您还可以将该深度的年龄估计迭代存储在一个新变量中，然后查询它：

```{r}
a.d20 <- Bacon.Age.d(20)
summary(a.d20)
```

```{r}
hist(a.d20)
```

或者计算在 30 到 20 cm深度之间的沉积经过了多长时间：

```{r}
a.d30 <- Bacon.Age.d(30)
a.d20 <- Bacon.Age.d(20)
summary(a.d30-a.d20)
```

```{r}
hist(a.d30-a.d20)
```

还可以研究特定深度或年龄的累积速率：

```{r}
acc.d20 <- accrate.depth(20)
summary(acc.d20)
```

```{r}
acc.a4500 <- accrate.age(4500)
summary(acc.a4500)
```

# 常问问题

## bacon代表什么？

贝叶斯累积模型。它也代表一种早餐食品，可以软/厚或松脆/薄，很像Bacon的先前设置。

此外，弗朗西斯·Bacon（Francis Bacon，1561-1626）曾经说过："如果我们从确定开始，就会以怀疑结束；但如果我们从怀疑开始，并对它们保持耐心，我们就会以肯定结束"。 这句话非常适合贝叶斯年龄模型，它旨在表达和稳健地量化时间顺序的不确定性（并且在这方面做得比经典方法)更好\[\^1\]。

## 我不喜欢Bacon

试试`tofu()`，它的作用完全一样，但没有肉。

## 我如何引用Bacon？

Please cite Blaauw and Christen 2011\[\^2\], as well as the rbacon version you are using (check this with sessionInfo()), any calibration curve(s)\[\^3\] used and also any non-default settings.

使用最新版本的 rbacon 并定期检查是否有新版本发布也是一个好主意。运行update.packages(),或检查 CRAN \[\^4\]install.packages('rbacon')的当前版本号。请定期检查并安装 R\[\^5\] 本身的更新。

## 你能帮助我吗？

阅读常见问题解答后，您可以联系 Maarten Blaauw maarten.blaauw\@qub.ac.uk获取有关使用"rbacon"的帮助，或联系 Andres Christen jac\@cimat.mx获取更详细的统计/贝叶斯问题。请提供任何必要的 .csv 文件以及 R 命令和输出的确切列表。

## 我发现了错误或对新功能有想法

如果您的问题包含很多统计细节，请联系 Maarten Blaauw maarten.blaauw\@qub.ac.uk了解 rbacon 特定的错误/功能，和/或 Andres Christen jac\@cimat.mx 。谢谢你。

## 我应该把我的文件放在哪里？

默认情况下，Bacon 在文件夹中查找一个文件Bacon_runs夹（有时称为Cores），与您的岩心同名。因此，如果您的岩心名为MyLakeCore，那么 Bacon 将查找名为 的文件夹MyLakeCore，然后在该文件夹中查找文件MyLakeCore.csv。注意大小写，**最好不要在名称中使用空格**。

您的文件应包含如下标题，并且字段应以逗号分隔。在 MS-Excel 或 Libreoffice 的 Calc 等电子表格程序中，您可以将文件保存为 .csv。然后在纯文本编辑器（如写字板或记事本）中打开 .csv 文件通常是个好主意，以检查所有内容是否干净（例如，没有仅用逗号填充的行，或大量引号）。 它在电子表格程序中的样子： \| lab ID \| Age \| Error \| Depth \| cc \| \| ----------- \| ----------- \| ----- \| -------- \| ---- \| \| UBA-28881 \| 2200 \| 20 \| 5 \| 1 \| \| UBA-28882 \| 2400 \| 20 \| 10 \| 1 \| \| UBA-28883 \| 3550 \| 30 \| 20 \| 1 \| \| UBA-28884 \| 4200 \| 35 \| 25 \| 1 \|

在纯文本编辑器中（添加空格以增强可读性）： lab ID, Age, Error, Depth, cc UBA-28881, 2200, 20, 5, 1 UBA-28882, 2400, 20, 10, 1 UBA-28883, 3550, 30, 20, 1 UBA-28884, 4200, 35, 25, 1

## 如何设置不同的校准曲线？

默认情况下，rbacon 使用 IntCal20 北半球校准曲线\[\^6\]或cc=1. 这可以设置为 Marine20 \[\^7\]校准曲线 ( cc=2)、南半球 SHCal20 \[\^8\]曲线 ( cc=3)，甚至是定制的 ( cc=4)。cc选项可以在 Bacon 命令中提供（例如，`Bacon("MyCore", cc=3)`），但出于透明度和一致性的原因，我们建议改为将cc第五列添加到岩心的 .csv 文件中：

| lab ID    | Age  | Error | Depth | cc  |
|-----------|------|-------|-------|-----|
| UBA-28881 | 2200 | 20    | 5     | 3   |
| UBA-28882 | 2400 | 20    | 10    | 3   |
| UBA-28883 | 3550 | 30    | 20    | 3   |
| UBA-28884 | 4200 | 35    | 25    | 3   |

请注意，Bacon需要原始的、未校准的放射性碳日期作为输入，并且这些日期在建模过程中进行了校准。

## 如何包含非 14C 日期？

这里cc又是你的朋友。已经在 cal BP 尺度上的日期，例如独立测定的 tephras、花粉记录或已知的岩心表面年龄应该得到cc=0. 请将任何 AD 日期转换成 cal BP ( cal BP = 1950 - AD)。应该用 IntCal20 北半球校准曲线校准的放射性碳日期获得cc=1, 那些用 Marine20 cc=2, 那些用 SHCal20 曲线cc=3, 那些用定制的cc=4:

| lab ID    | Age  | Error | Depth | cc  |
|-----------|------|-------|-------|-----|
| surface   | -65  | 10    | 0     | 0   |
| UBA-28881 | 2200 | 20    | 5     | 3   |
| UBA-28882 | 2400 | 20    | 10    | 3   |
| UBA-28883 | 3550 | 30    | 20    | 3   |
| UBA-28884 | 4200 | 35    | 25    | 3   |

对于 Pb-210 数据，请考虑使用rplumR 包，而不是将 CRS 模型输出作为 cal BP 日期输入到Bacon。

请注意，Bacon预计其所有日期的误差均 \>0。

## 我可以推断超出过时的水平吗？

是的，使用选项d.min和/或d.max，默认情况下，它们被设置为日期深度的上限和下限。

## Bacon可以计算特定深度的年龄估计值吗？

默认情况下，Bacon会计算从上到下深度的每cm的年龄估计值。这可以通过为d.by指定不同的步长来更改。默认深度单位是depth.unit="cm"，这也可以调整。您还可以提供深度列表，例如 ，`Bacon("MyCore", depths=1:50)`或将它们放在MyCore_depths.csv岩心文件夹中的文件中，然后以`Bacon("MyCore", depths.file=TRUE)`.

你也可以在运行后要求提供任何岩心深度的年龄估计，例如 23.45 cm：

```{r}
Bacon.hist(23.45)
depth23.45 <- Bacon.Age.d(23.45)
hist(depth23.45)
mean(depth23.45)
```

## Bacon可以考虑沉积间断或快速沉积吗？

是的。如果你的岩心地层表明在 30 cm岩心深度处有一个沉积间断，请将其设为Bacon(hiatus.depths=30)。对于多个间断，将值用`,`连接，例如`Bacon(hiatus.depths=c(30,52))`。bacon会跳过间断点或边界，失去对累积速率的Memory。

如果您期望边界而不是沉积间断，所以只是沉积速度的突然变化而没有伴随的时间间隙，那么使用边界，如`Bacon(boundary=30)`或`Bacon(boundary=c(30,52))`。

如果您发现突然快速沉积事件，例如可见的火山灰层，也可以通过提供它们的顶部和底部深度来模拟这些事件，例如 Bacon(slump=c(20,30, 50,55))对于 55-50 和 30-20 cm深度的坍塌。

## 如何提取不同深度的批量沉降率作为文本文件

Check the .out file, or:

```{r}
acc20 <- accrate.depth(20)
summary(acc20)
depths <- c(0,3,4,6,7.2, 8, 9, 10, 20:30)
min.acc <- 0; max.acc <- 0; median.acc <- 0
for(i in 1:length(depths)) {
  accs <- accrate.depth(depths[i])
  minmax <- quantile(accs, c(.025, .975, .5))
  min.acc[i] <- minmax[1]
  max.acc[i] <- minmax[2]
  median.acc[i] <- minmax[3]
}
write.table(cbind(depths, min.acc, max.acc, median.acc), “my_accs.txt”, header=TRUE)


```

## 如何重新加载以前的运行？

首先加载旧的运行（确保重新输入任何非默认的先前设置），告诉 Bacon 不要再次运行它，然后生成一个图表将所有数据加载到 R 的内存中。在此之后，您应该能够像以前一样继续：

```{r}
Bacon("MyCore", run=FALSE)
agedepth()
# or 如果你在之前设置的累积率与默认值不同的话:
Bacon("MyCore", run=FALSE, acc.mean=c(20,5))
agedepth()
```

## 我应该使用多大的thick值？

在大多数情况下，Bacon应该能够找到合适的厚度值。默认值为 5 cm，但如果您的岩心非常短或非常长，建议使用另一个厚度值。太厚的部分看起来很 "弯"，而太薄的部分可能导致参数太多，导致模型 "丢失"。 我们总是建议尝试几个设置值，以确保你的结果是稳健的，不会对设置中的微小变化过于敏感。不同的thick厚度值可以设置如下。

```{r}
Bacon("MyCore", thick=1)
Bacon("MyCore", 1)
```

## 为什么我的年龄模型看起来像a trumpet？

也许模型迷失了，因为有太多的参数需要估计。该模型是否遵循一些日期的深度，但随后它与其他日期的深度相背离并运行？试着用较少的部分来运行它（较大的thick厚度值）。

## 我应该调整先验以完全匹配我的岩心的累积速率吗？

不会。在大多数情况下，acc.mean 的默认值或建议值应该可以正常工作。默认形状参数acc.shape=1.5设置为允许大范围的累积速率，并且数据将允许Bacon更新我们关于最可能的累积速率值的信息。记忆的强度参数`mem.strength=10` 也是如此。因此，先验分布比后验分布宽得多是完全可以的------我们已经更多地了解了构成年龄深度模型的参数值。

但是，如果您有关于样点沉积历史的其他信息，则可以通过设置"更强"、更多信息的先验来包含这些信息。例如，已知一个站点的积累率没有大的波动，那么可以将内存先验设置为接近 1（例如，mem.strength=50, mem.mean=0.9）。 另一方面，对于那些假定经历过大的沉积波动的地点，可以通过将内存先验设置为非常低的值（mem.strength=50，mem.mean=0.1）来建模。

**先验信息的概念就是这样；它是您在开始查看新数据之前获得的有关该样点的信息。然后Bacon会将先前的信息与数据结合起来更新我们的信息。**

## 我可以为岩心的不同部分设置不同的累积速率吗？

是的，通过在累积速率变化的深度定义边界或断点，并为每个部分提供不同的累积速率先验。例如，如果您的岩心地层在 80 cm深度处从湖泊变为沼泽，而沼泽的累积率的先验信息是acc.mean=10，湖泊的acc.mean=50，那么你可以这样建模。

```{r}
Bacon("MyCore", boundary=80, acc.mean=c(10, 50))
```

越过边界或间断，Bacon将失去记忆，因此边界/间断之上的累积速率不会被其下方的累积速率告知。

## 我应该使用平均年龄还是中位数年龄？

Bacon 提供每个岩心深度的年龄估计，这可以简化为95%的范围，或平均数或中值。然而，仅使用平均值或中位数忽略了年龄估计中通常存在相当大的时间不确定性。**为什么不使用所有年龄模型信息并使用该proxy.ghost函数绘制数据？**

如上所述，你也可以在运行后评估任何岩心深度的年龄估计，例如23.45cm。

```{r}
Bacon.hist(23.45)
depth23.45 <- Bacon.Age.d(23.45)
hist(depth23.45)
mean(depth23.45)
quantile(depth23.45, probs=c(.025, .975))
```

## 我应该只对有很多日期的岩心使用贝叶斯年龄模型吗？

贝叶斯年龄模型可以处理令人印象深刻的测年密度和质量范围\[\^9\]，并且对于只有很少日期的岩心也能很好地工作。事实上，在日期很少的情况下，模型的选择变得更加重要，所以贝叶斯年龄模型对于低分辨率的岩心也是比较好的。

## 那些蓝色的斑点是什么，它们在深度尺度上有什么作用？

这些是年代深度的年龄分布。它们位于日历轴上，并且它们每年的概率以深度刻度表示（想象每个单独的日期都有一个不可见的附加轴）。默认情况下，每个日期都具有相同的绘图区域，所以非常精确的日期将比不太精确的日期的峰值高（陡峭）得多（在深度轴上）。

## 先验 -- 选择哪些值？

-   出于一致性和透明度的考虑，尽可能使用**默认值**
-   或者接受**建议的值**，并在你的论文中说明。
-   如果你有更多的信息，你可以调整先验值
    -   例如，对最近的湖泊、冰川湖的acc.mean进行调整
    -   如果你有关于acc.rate的可靠信息（例如，来自爆炸后的一系列日 期），可以调整acc.shape。
    -   mem.mean：如果你预计acc.rate的变化很大的话。
    -   mem.strength：如果你有关于记忆的强大信息
-   测试一系列的先验因素--你的模型应该对设置具有鲁棒性

## 什么表明一个好的年龄深度模型？

首先，检查 MCMC 运行（左上图）是否看起来稳定，就像没有主要结构的**白噪声**一样，迭代似乎"卡住"了。确保没有剩余的老化。如果 MCMC 看起来很糟糕，可以通过指定不同的ssize值（默认为2000）来尝试更长时间的运行。您始终可以运行scissors或thinner命令将 MCMC 运行修剪为运行后良好且易于管理的内容。

其次，检查积累率和记忆的后验（灰色分布）（如果是推断的，还有间断期）是否与先验重叠（绿色曲线；那么就没有学到多少新东西），或者后验是否已经从先验与数据的结合中学习到了。

最后，根据您掌握的样点信息，检查年龄深度模型本身是否合理。**日期**是否合适，是否有任何**弯曲**有意义，任何**离群**的日期是否有意义，**灰度不确定性估计**看起来是否合适？这里需要一定程度的用户专业知识。

## 参考

1.  Blaauw, M., Christen, J.A., Bennett, K.D., Reimer, P.J., 2018. Double the dates and go for Bayes -- impacts of model choice, dating density and quality on chronologies. Quaternary Science Reviews 188, 58-66↩︎

2.  Blaauw, M., Christen, J.A., 2011. Flexible paleoclimate age-depth models using an autoregressive gamma process. Bayesian Analysis 6, 457-474↩︎

3.  Reimer, P. et al., 2020. The IntCal20 northern hemisphere radiocarbon age calibration curve (0--55 cal kBP). Radiocarbon 62, 725-757↩︎

4.  cran.r-project.org/package=rbacon↩︎

5.  www.r-project.org/↩︎

6.  Reimer, P. et al., 2020. The IntCal20 northern hemisphere radiocarbon age calibration curve (0--55 cal kBP). Radiocarbon 62, 725-757↩︎

7.  Heaton, T. et al. 2020. Marine20 --- the marine radiocarbon age calibration curve (0--55,000 cal BP). Radiocarbon 62, 779-820↩︎

8.  Hogg, A. et al. 2020. SHCal20 southern hemisphere calibration, 0--55,000 years cal BP. Radiocarbon 62 759-778↩︎

9.  Blaauw, M., Christen, J.A., Bennett, K.D., Reimer, P.J., 2018. Double the dates and go for Bayes -- impacts of model choice, dating density and quality on chronologies. Quaternary Science Reviews 188, 58-66↩︎

# rplum P-210测年

现在我们转向 Plum，进行 Pb-210 年龄深度建模。我们再次假设您已经安装了它（请参见此处），因此我们只需加载它：

```{r}
require(rplum)
```

运行默认核心。这需要一段时间才能运行，因此我们可能不会在会话期间运行核心。rplum 运行往往比 rbacon 运行花费更长的时间，因为通常需要估计更多参数，尤其是因为 rplum 的**默认截面厚度是1cm**，而不是 rbacon 的5cm（你认为我们为什么会做出这样的选择？）。

让我们运行默认核心（接受所有默认值）：

```{r}
Plum()
```

与rbacon一样，我们有顶级小图（但更多），以及主图。所有的面板都是有用的，并且应该在论文中提出来! 前三个是和rbacon一样的，然后还有两个是Pb流入和支持的Pb(the Pb influx and the supported Pb)。主面板也与rbacon不同，它显示了Pb的测量值（蓝色方块）和它们的模型值（蓝标）。

如果你的岩心也有镭数据来估计支持的Pb，你可以假设镭值在整个岩心中是恒定的（ra.case=1；这需要更少的参数，因此运行得更快）。

```{r}
Plum(“LL14”, ra.case=1)
```

或者假设值在整个核心中波动（运行时间更长）：

```{r}
Plum(“LL14”, ra.case=2)
```

如果您有其他日期信息，例如历史标记或放射性碳日期，也可以添加这些信息（使用 rbacon 的 .csv 文件的数据格式）：

```{r}
Plum(“LL14”, ra.case=1, otherdates=”LL14_14C.csv”)
```
